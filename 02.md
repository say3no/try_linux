プロセスはシステムコールでカーネルに処理を依頼。
システムコールはプロセスの生成削除、メモリ確保、開放、プロセス間通信、ネットワーク、ファイルシステム操作、ファイル操作（デバイスアクセス）
システムコールを発行すると、CPUに対して割り込みイベントが発生する。システムコールが終了すれば、再びユーザモードに戻ってプロセスの動作を継続する。

まとめると、プロセスがユーザーモードで、システムコールがカーネルモードの処理。

全体的にテキストをなぞるばかりでどんなオプションがあるのか、その意味はなんなのかを把握していない。

## strace
調べてないけど語源はsystem call traceみたいな感じ。プロセスが呼び出すシステムコールのログを見ることができる。`-T`で各システムコール発行時の時刻をログの末尾に<マイクロ秒>で表示する。
```
root@a8129f7af9b2:/codes/02# strace -T -o hello.log ./hello ; cat hello.log | grep write
hello world
write(1, "hello world", 11)             = 11 <0.000078>
```

このテキストの素晴らしいところは`hello.py`,`hello.c`のどちらもsytemcallする段階ではほぼ同じということをstraceによって観察させてくれる点だ。またプリミティブなCが本当に早いということをなんとなく分からせてくれる。これでgoがはやいrustがどうだという話を少しは理解できるようになったのかもしれない。

## sar
System Admin Reporter。

>sarとは、sysstatパッケージに含まれている、システムの統計情報を取得するコマンドです。名前は、System Admin Reporterの頭文字をとったものになります。[sarコマンドでLinuxサーバのシステムモニタリングを行う方法](http://naoberry.com/tech/sar/)

```bash
root@15a3bd7cbac4:/# sar -tt -P ALL 1
Linux 4.9.87-linuxkit-aufs (15a3bd7cbac4)       05/26/18        _x86_64_        (2 CPU)

11:48:03        CPU     %user     %nice   %system   %iowait    %steal     %idle
11:48:04        all      0.00      0.00      0.00      0.00      0.00    100.00
11:48:04          0      0.00      0.00      0.00      0.00      0.00    100.00
11:48:04          1      0.00      0.00      0.00      0.00      0.00    100.00

^C

Average:        CPU     %user     %nice   %system   %iowait    %steal     %idle
Average:        all      0.00      0.00      0.00      0.00      0.00    100.00
Average:          0      0.00      0.00      0.00      0.00      0.00    100.00
```

各行がCPUコアを指し示しており、dockerのconfを見るとたしかに`CPUs:2`と設定してある。記載はしないが、dockerのCPUsリソース設定を4にして試したところ確かにallを含めて5行ある。わくわくする。ここで、おもむろにコンテナの外側から`docker inspect try_linux`を試みる。以前はTCP/IPより上のレイヤやボリューム程度のことしか理解できなかったが、以前よりは理解できるのではないかという期待からだ（たった２つのコマンドを覚えただけだが）。相変わらず明瞭に理解できない点は多いが、この本が終わった頃には理解できるのではないかという希望を抱く。

>一概には言えないが、systemが数十のような大きな値になっているときは、むやみにシステムコールを発行しすぎていたり、システムの負荷が高すぎたりという、良くない状態であることが多いです。

 - systemcallはつうじょうの関数呼び出しとは異なり、C言語などの高級言語から直接呼びだせない。アーキテクチャ依存のセンブリコードを使って呼び出す。
 - OSの助けが無ければ、各プログラムはシステムコールを発行するたびにアーキテクチャ依存のアセンブリソースをかいて、高級言語からそれを呼び出さなくてはならない。
 - OSは、システムコールを呼び出すラッパー関数を用意している。

## ldd
なんの略かはしらん。プログラムがどのようなライブラリとリンクしているかを示すコマンド。
```
ldd /usr/bin/python
```
などとやると`libc`を含んでいる事がわかり、pythonは内部的には標準Cライブラリを使っている事がわかる。

## OSが提供するプログラム
init,sysctl,nice,sync,touch,grepなど。gccやpython,rubyなどもOSが提供している。もちろんシェルやwindow systemも。
